<%- include('partials/header', { title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰' }) %>

    <main class="container">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰</h1>
        
        <div class="admin-actions">
            <a href="/dashboard" class="btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <a href="/dashboard/user-search" class="btn">Ø§Ø¹Ø§Ø¯Ø© ØªØºÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</a>
        </div>
        
        <div class="table-responsive">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                        <th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>

                    </tr>
                </thead>
                <tbody>
                    <% patients.forEach(patient => { %>
                        <tr data-user-id="patient.id">
                            <td><%= patient.id %></td>
                            <td>
                                <img src="<%= patient.image || 'https://via.placeholder.com/50' %>" 
                                     alt="<%= patient.name %>" class="patient-thumb">
                            </td>
                            <td><%= patient.name %></td>
                            <td><%= patient.username %></td>
                            <td><%= patient.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±' %></td>
                            <td><%= patient.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±' %></td>
                            
                            <td>
                            <% if (patient.password && patient.password !== '********') { %>
                                <span class="password-hash" title="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø´ÙØ±Ø©"><%= patient.password %></span>
                            <% } else { %>
                                <%= patient.password || 'ØºÙŠØ± Ù…Ø¹ÙŠÙ†' %>
                            <% } %>
                            </td>
                            <td><%= patient.appointments?.length || 0 %></td>
                            <td class="actions">
                                <button class="btn"><a href="/patient/<%= patient.id %>" style="text-decoration: none;">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a></button>
                                <form action="/dashboard/delete-patient/<%= patient.id %>?_method=DELETE" method="POST" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ØŸ');">
                                    <button type="submit" class="btn btn-delete">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </form>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </main>

<!-- 
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', async function() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ù…Ø±ÙŠØ¶ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) return;
            
            const row = this.closest('tr');
            const userId = row.getAttribute('data-user-id');
            
            try {
                const response = await fetch(`/dashboard/delete-user/${userId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    row.remove();
                } else {
                    alert('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
            }
        });
    });
});
    </script> -->

<%- include('partials/footer') %>