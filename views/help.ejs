<%- include('partials/header', { title: 'سجل النشاطات' }) %>

<main class="container">
    <section class="hero">
        <h2>هل تواجه مشكلة في شيء ما ؟</h2>
        <p>تواصل معنا بكل سهولة</p>
    </section>
<% if (req.query.sent === 'true') { %>
  <div class="success-message">✅ تم إرسال الرسالة بنجاح!</div>
<% } %>
<% if (error !== false) { %>
  <div class="success-message" id="error-msg" style="background-color: #ff0000"><%= error %></div>
<% } %>


<% if (typeof remainingTime !== 'undefined') { %>
 <div class="timer-message">
    ⏳ يمكنك إرسال رسالة بعد: <span id="countdown"></span>
  </div>
<% } %>





    <form action="/help" method="POST">
            <div class="form-group">
                <label for="num">رقم هاتفك:</label>
                <input type="number" id="name" name="num" required>
            </div>
            <div class="form-group">
                <label for="title">عنوان الموضوع:</label>
                <input type="text" id="name" name="title" required>
            </div>
            <div class="form-group">
                <label for="name">تفاصيلل الموضع:</label>
                <textarea rows="10" name="message" required></textarea>
            </div>
            <button type="submit" class="btn" id="sendBtn">ارسال</button>
    </form>
    <br>
    <section class="features">
            <div class="feature">
                <h3>او تواصل معنا عبر الواتساب</h3>
                <p><a href="https://wa.me/9647761763665" target="_blank">اضغط هنا</a></p>
            </div>
    </section>
</main>


<style>
.success-message {
  position: absolute;
  left: 40%;
  right: 50%;
  transform: translate(50%, 50%);
  text-align: center;
  padding: 2rem 1rem;
  font-size: 2rem;
  background-color: #d4edda;
  color: #155724;
  width: 20%;
  border-radius: 5px;
}
</style>

<% if (typeof remainingTime !== 'undefined') { %>
 

  <script>
    const countdownElement = document.getElementById('countdown');
    const sendBtn = document.getElementById('sendBtn');
    const errMSG = document.getElementById('error-msg');
    let remaining = <%= remainingTime %>; // بالميلي ثانية

    // ❌ عطّل الزر بالبداية
    sendBtn.disabled = true;
    sendBtn.style.opacity = 0.5;
    sendBtn.style.cursor = 'not-allowed';


    function updateCountdown() {
      const minutes = Math.floor(remaining / 60000);
      const seconds = Math.floor((remaining % 60000) / 1000);
      countdownElement.textContent = `${minutes} دقيقة و ${seconds} ثانية`;

      if (remaining <= 0) {
        countdownElement.textContent = "✅ يمكنك الآن إرسال رسالة جديدة";
        sendBtn.disabled = false;
        sendBtn.style.opacity = 1;
        sendBtn.style.cursor = 'pointer';
        errMSG.style.display = "none"
        return;
      }
      
      remaining -= 1000;
      setTimeout(updateCountdown, 1000);
    }

    updateCountdown();
  </script>
<% } %>
<%- include('partials/footer') %>
